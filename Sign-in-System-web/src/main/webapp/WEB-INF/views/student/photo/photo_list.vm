<!DOCTYPE html>
<html>
<head>
    <title>学生签到系统</title>
    <meta charset="UTF-8"/>
    <link rel="stylesheet" type="text/css" href="/resources/css/bootstrap.css"/>
    <link rel="stylesheet" type="text/css" href="/resources/css/style.css"/>
    <link rel="stylesheet" type="text/css" href="/resources/css/validform_style.css"/>
    <link rel="stylesheet" type="text/css" href="/resources/css/zzsc.css"/>

    <script type="text/javascript" src="/resources/js/jquery.min.js"></script>
    <script type="text/javascript" src="/resources/js/bootstrap-dropdown.js"></script>
    <script type="text/javascript" src="/resources/js/Validform_v5.3.2.js"></script>
    <script src="/resources/js/mobile/student/photo_list/index.js"></script>
</head>
<body>
    #parse("student/toolbar.vm")
<div class="container">
    <div class="select_all_bar">
        <input type="checkbox" id="inlineCheckbox1" value="option1" onclick="selectAll()"> 全选
        <button class="btn btn-primary" type="button" onclick="multiDel()">删除</button>
    </div>

    <div id="waterfall">
        #foreach($photo in $photoList)
            <div class="cell">
                <a href="#">
                    <img src="getPhoto.html?path=${photo}" name="${photo}" alt="${photo}"/>
                </a>
                <p class="del-photo">
                    <input type="checkbox" name="select_item" data-sel="${photo}">
                    <a name="${photo}" role="button" onclick="deletePhotoByName(this)">删除</a>
                </p>
            </div>
        #end
    </div>
</div>
</body>
<script>
    function deletePhotoByName(ele) {
        var photo = ele.name;

        if (confirm("确定删除该照片？")) {
            jQuery.ajax({
                url: "deletePhotoByName.html",
                type: "post",
                data: "photo=" + photo,
                success: function (data) {
                    data = eval("(" + data + ")");
                    var status = data.status;
                    if (status == 1) {
                        $(ele).parent().parent().parent().remove();
                    }
                    var msg = decodeURI(data.message);
                    alert(msg);
                },
                error: function () {
                    alert("删除失败");
                }
            });
        }


    }
</script>
<script>
    var hasSelectAll = false;
    function selectAll() {
        if (hasSelectAll) {
            $("input[name='select_item']").each(function () {
                $(this).prop("checked", false);
            });
        }
        else {
            $("input[name='select_item']").each(function () {
                $(this).prop("checked", true);
            });
        }
        hasSelectAll = !hasSelectAll;
    }

</script>
<script type="text/javascript">
    function multiDel() {
        if (confirm("确定删除?")) {
            var data = "";
            $("input[name='select_item']:checked").each(function () {
                data = data + $(this).data("sel") + ";";
            });
            if (data == "") {
                alert("请选择照片");
                return;
            }
            jQuery.ajax({
                url: "deleteMultiPhoto.html",
                type: "post",
                data: "photo=" + data,
                success: function (data) {
                    data = eval("(" + data + ")");
                    var msg = decodeURI(data.message);
                    if (data.status == 1) {
                        $("input[name='select_item']:checked").each(function () {
                            $(this).parent().parent().parent().parent().remove();
                        });
                    }
                    alert(msg);
                },
                error: function () {
                    alert("删除失败");
                }
            });
        }
    }

</script>
<script>
    var opt = {
        getResource: function (index, render) {
            var html = '';

            return $(html);
        },
        auto_imgHeight: true,
        insert_type: 1
    }
    $('#waterfall').waterfall(opt);
</script>
</html>